<!doctype html>
<html>

<head>

	<link rel="stylesheet" type="text/css" href="${def:context}/dinamica_bkp.css" />
	<link rel="stylesheet" type="text/css" href="${def:context}/main.css" />
	
	<script type="text/javascript" src="${def:context}/action/script">
	</script>
	
	<!--Geolocalizacion - SIMONE Key=AIzaSyDD4qOQanvBTj9kD631CwiIGt6vmkKxOB4-->
    <script src="http://maps.google.com/maps?file=api&amp;v=2.x&amp;key=AIzaSyDD4qOQanvBTj9kD631CwiIGt6vmkKxOB4" type="text/javascript"></script>

	<script type="text/javascript">
		//invoca la generacion de un PDF en un popup
		function openPDF()
		{
			var features = "height=500,width=800,status=no,toolbar=no,menubar=no,location=no,scrollbars=yes,resizable=yes";
			var url = "${def:context}${def:actionroot}/pdf?random=" + Math.random();
			var w = window.open(url, null, features);
		}
		
		//exportar a excel
		function openExcel() {
			var features = "height=500,width=800,status=no,toolbar=no,menubar=no,location=no,scrollbars=yes,resizable=yes";
			var url = "${def:context}${def:actionroot}/excel?random=" + Math.random();
			var w = window.open(url, null, features);
		}
		
		//exportar a xml
		function openXml(id) {
			var features = "height=500,width=800,status=no,toolbar=no,menubar=no,location=no,scrollbars=yes,resizable=yes";
			var url = "${def:context}${def:actionroot}/xml/search?id=" + id;
			var w = window.open(url, null, features);
		}
		
		//exportar a texto
		function openTxt(id) {
			var features = "height=500,width=800,status=no,toolbar=no,menubar=no,location=no,scrollbars=yes,resizable=yes";
			var url = "${def:context}${def:actionroot}/txt/search?id=" + id;
			var w = window.open(url, null, features);
		}
		
		//envio de emails
		function openEmails() {
			var uri = "${def:context}${def:actionroot}/email/form";					
			openDialog("editor0", uri, 980, 600);	
		}
	</script>

</head>

<body>

	<!--banner-->
	<div class="bannerDialog" id="encabezado_tabla">
		${lbl:b_financial_entities}
		<img src="${def:context}/images/close.png" class="button" onclick="parent.closeDialog()" title="${lbl:b_close_button}" style="float:right; cursor:pointer;"/>
	</div>

	<table>
	
	<tr>
	<td>
	&nbsp;
	</td>
	</tr>
	
	<tr>
	<td>
	
	<table class="record" style="width:500px;">
		<tr>
			<td width="40%">${lbl:b_code}</td>
			<td style="background-color: white">${fld:efi_codigo}</td>
		</tr>
		<tr>
			<td width="40%">${lbl:b_name}</td>
			<td style="background-color: white">${fld:efi_nombre}</td>
		</tr>
		<tr>
			<td width="40%">${lbl:b_address}</td>
			<td style="background-color: white">${fld:dir_descripcion}</td>
		</tr>
		<tr>
			<td width="40%">${lbl:b_fixed_phone}</td>
			<td style="background-color: white">${fld:efi_telefono_fijo}</td>
		</tr>
		<tr>
			<td width="40%">${lbl:b_mobile_phone}</td>
			<td style="background-color: white">${fld:efi_telefono_movil}</td>
		</tr>
		<tr>
			<td width="40%">${lbl:b_aba_code}</td>
			<td style="background-color: white">${fld:efi_codigo_aba}</td>
		</tr>
		<tr>
			<td width="40%">${lbl:b_swift_code}</td>
			<td style="background-color: white">${fld:efi_codigo_swift}</td>
		</tr>
		<tr>
			<td width="40%">${lbl:b_req_intermediary_institution}</td>
			<td style="background-color: white">${fld:efi_req_banco_intermediario_combo}</td>
		</tr>
		<tr>
			<td width="40%">${lbl:b_intermediary_institution}</td>
			<td style="background-color: white">${fld:efi_nombre}</td>
		</tr>
		<tr>
			<td width="40%">${lbl:b_routing_code}</td>
			<td style="background-color: white">${fld:efi_routing}</td>
		</tr>
		<tr>
			<td width="40%">${lbl:b_account_executive}</td>
			<td style="background-color: white">${fld:efi_contacto}</td>
		</tr>
		<tr>
			<td width="40%">${lbl:b_store_date}</td>
			<td style="background-color: white">${fld:efi_fecha_registro@dd-MM-yyyy}</td>
		</tr>

	</table>
	
	</td>
	
	<td>

	<div id="map_canvas" style="width: 400px; height: 380px"></div>
	
     <input type="hidden" name="q" value="" size="40" />
     <input id="empresa" type="hidden" size="40"/>
     <input id="punto" type="hidden" size="40"/>
     <input id="kml" type="hidden" size="1024">

	</td>
	</tr>
	
	</table>

	<br>
	<div  align="center">
		<input id="salir" type="button" value="${lbl:s_exit}" onclick="parent.closeDialog()" class="button">
	</div>
	
<script type="text/javascript">

	onload = function()
	{ 
		initialize();
		
		var address = '${fld:prr_nombre_corto}, ${fld:mun_nombre_corto}, ${fld:ciu_nombre_corto}, ${fld:efe_nombre_corto}, ${fld:pai_nombre_corto}';
	    geocoder.getLocations(address, addAddressToMap);
	} 
	
	<!--Geocoder-->

    var map;
    var geocoder;

    function initialize() {
      map = new GMap2(document.getElementById("map_canvas"));
      map.setCenter(new GLatLng(40.452557, -3.510673), 15);
      
      // insertar los controles
      map.addControl(new GSmallMapControl());
      map.addControl(new GMapTypeControl());
      
      geocoder = new GClientGeocoder();
    }

    // addAddressToMap() is called when the geocoder returns an
    // answer.  It adds a marker to the map with an open info window
    // showing the nicely formatted version of the address and the country code.
    function addAddressToMap(response) {
      map.clearOverlays();
      if (!response || response.Status.code != 200) {
        alert("Lo sentimos, no se ha encontrado su direccion!!");
      } else {
        place = response.Placemark[0];
        point = new GLatLng(place.Point.coordinates[1], place.Point.coordinates[0]);
        
        map.setCenter(point, 15);
        
        marker = new GMarker(point, {draggable: true});
        
        GEvent.addListener(marker, "dragstart", function() {
          map.closeInfoWindow();
        });

        GEvent.addListener(marker, "dragend", function() {
          document.getElementById("punto").value = marker.getLatLng().toUrlValue();
          marker.openInfoWindowHtml(place.address);
          //generateKML(place.address, marker.getLatLng().lng(), marker.getLatLng().lat());
        });
        
        map.addOverlay(marker);
        marker.openInfoWindowHtml(place.address);
        document.getElementById("punto").value = marker.getLatLng().toUrlValue();
        
        //generateKML(place.address, place.Point.coordinates[0], place.Point.coordinates[1]);
        
      }
    }
    
    // showLocation() is called when you click on the Search button
    // in the form.  It geocodes the address entered into the form
    // and adds a marker to the map at that location.
    function showLocation() {
      var address = document.forms[0].q.value;
      //document.getElementById("empresa").value = '${fld:ent_descripcion_larga}';
      geocoder.getLocations(address, addAddressToMap);
    }

   // findLocation() is used to enter the sample addresses into the form.
    function findLocation(direccion, empresa ) {
      document.forms[0].q.value = direccion;
      document.getElementById("empresa").value = empresa;
      showLocation();
    }
    
    function generateKML(description, lng, lat){
      document.getElementById("kml").value = '';
      var kml = '<?xml version="1.0" encoding="UTF-8"?>\n';
      kml = kml + '<kml xmlns="http://earth.google.com/kml/2.2">\n';
      kml = kml + '<Placemark>\n';
      kml = kml + '\t<name>' + document.getElementById("empresa").value + '</name>\n';
      kml = kml + '\t<description>' + description + '</description>\n';
      kml = kml + '\t<Point><coordinates>' + lng + ',' + lat + ',0</coordinates></Point>\n'; 
      kml = kml + '</Placemark>\n';
      kml = kml + '</kml>\n'
      document.getElementById("kml").value = kml;
    }
	
</script>

</body>

</html>
