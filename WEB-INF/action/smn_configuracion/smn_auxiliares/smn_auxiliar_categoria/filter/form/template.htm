<!doctype html>
<html>

<head>

	<link rel="stylesheet" type="text/css" href="${def:context}/dinamica_bkp.css" />
		<link rel="stylesheet" type="text/css" href="${def:context}/main.css" />


<!--biblioteca generica JS/Dinamica-->
<script type="text/javascript" src="${def:context}/action/script">
</script>

</head>

<body>

<!--banner-->
<div class="banner" id="encabezado_tabla">
	${lbl:b_auxiliary}
	<img src="${def:context}/images/close.png" class="button" onclick="parent.closeDialog(); parent.search();" title="${lbl:b_close_button}" style="float:right; cursor:pointer;">
	${req:progress}
</div>

<!--formulario de filtro-->
<form name="form1" onsubmit="return search()" style="width:650px;">

	<!--titulo-->
	<h1>${lbl:b_filter_find}</h1>

	<table>

	<!--ancho de la columna de etiquetas-->
	<col style="width:40%">

	<!--campos-->
		<tr>
		<td>${lbl:b_nature_auxiliary}</td>
		<td>
			<select name="naa_nombre" id="naa_nombre" onchange="chgCombo(naa_nombre.options[naa_nombre.selectedIndex].text,'naa_nombre_name');">
				<option value="">[Cualquiera]</option>
				<aca_naturaleza_auxiliar_rows>
				<option value="${fld:id}">${fld:item}</option>

				</aca_naturaleza_auxiliar_rows>
			</select>
			<input id="naa_nombre_name" name="naa_nombre_name" type="hidden">
		</td>
	</tr>
	<tr>
		<td>${lbl:b_entity}</td>
		<td>
			<select name="ent_descripcion_corta" id="ent_descripcion_corta" onchange="chgCombo(ent_descripcion_corta.options[ent_descripcion_corta.selectedIndex].text,'ent_descripcion_corta_name');">
				<option value="">[Cualquiera]</option>
				<aca_empresa_rows>
				<option value="${fld:id}">${fld:item}</option>

				</aca_empresa_rows>
			</select>
			<input id="ent_descripcion_corta_name" name="ent_descripcion_corta_name" type="hidden">
		</td>
	</tr>
	<tr>
		<td>${lbl:b_subsidiary}</td>
		<td>
			<select name="suc_nombre" id="suc_nombre" onchange="chgCombo(suc_nombre.options[suc_nombre.selectedIndex].text,'suc_nombre_name');">
				<option value="">[Cualquiera]</option>
				<aca_sucursal_rows>
				<option value="${fld:id}">${fld:item}</option>

				</aca_sucursal_rows>
			</select>
			<input id="suc_nombre_name" name="suc_nombre_name" type="hidden">
		</td>
	</tr>
	<tr>
		<td>${lbl:b_business_unit}</td>
		<td>
			<select name="uen_nombre" id="uen_nombre" onchange="chgCombo(uen_nombre.options[uen_nombre.selectedIndex].text,'uen_nombre_name');">
				<option value="">[Cualquiera]</option>
				<aca_unidad_negocio_rows>
				<option value="${fld:id}">${fld:item}</option>

				</aca_unidad_negocio_rows>
			</select>
			<input id="uen_nombre_name" name="uen_nombre_name" type="hidden">
		</td>
	</tr>
	<tr>
		<td>${lbl:b_service_area}</td>
		<td>
			<select name="ase_descripcion" id="ase_descripcion" onchange="chgCombo(ase_descripcion.options[ase_descripcion.selectedIndex].text,'ase_descripcion_name');">
				<option value="">[Cualquiera]</option>
				<aca_area_servicio_rows>
				<option value="${fld:id}">${fld:item}</option>

				</aca_area_servicio_rows>
			</select>
			<input id="ase_descripcion_name" name="ase_descripcion_name" type="hidden">
		</td>
	</tr>
	<tr>
		<td>${lbl:b_service_unit}</td>
		<td>
			<select name="uns_descripcion" id="uns_descripcion" onchange="chgCombo(uns_descripcion.options[uns_descripcion.selectedIndex].text,'uns_descripcion_name');">
				<option value="">[Cualquiera]</option>
				<aca_unidad_servicio_rows>
				<option value="${fld:id}">${fld:item}</option>

				</aca_unidad_servicio_rows>
			</select>
			<input id="uns_descripcion_name" name="uns_descripcion_name" type="hidden">
		</td>
	</tr>
	<tr>
		<td>${lbl:b_store_date_grater_than}</td>
		<td>
			<input id="aca_fecha_registro_ini" name="aca_fecha_registro_ini" type="text" class="date" maxlength="10">
			<img src="${def:context}/images/dropdown.png" title="${lbl:b_deploy_calendar}" onclick="calendarOpen('aca_fecha_registro_ini')">
		</td>
	</tr>
	<tr>
		<td>${lbl:b_store_date_less_than}</td>
		<td>
			<input id="aca_fecha_registro_fin" name="aca_fecha_registro_fin" type="text" class="date" maxlength="10">
			<img src="${def:context}/images/dropdown.png" title="${lbl:b_deploy_calendar}" onclick="calendarOpen('aca_fecha_registro_fin')">
		</td>
	</tr>


	</table>


	<!--botones-->
	<input type="submit" value="${lbl:b_find_button}" class="button">
	<input id="grabar" type="submit" value="${lbl:b_add_button}"  onclick="showEditor()" class="button">
	<input type="button" value="${lbl:b_clean_button}" class="button" onclick="clearForm('form1')">
	<input id="copiar" type="button" value="${lbl:b_copy_button}" onclick="getFormValuesToCopy('form1')" class="button">
	<input id="pegar" type="button" value="${lbl:b_paste_button}" onclick="getFormValuesToPaste('form1')" class="button">
	<input id="salir" type="button" value="${lbl:s_exit}" onclick="parent.closeDialog(); parent.search();" class="button">

</form>

<!--panel de respuesta AJAX #1-->
<div id="response" style="display:none; width:100%; margin-top:10px;"></div>

</body>

<!--codigo de soporte del template-->
<script type="text/javascript">

	//inicializacion de la pagina cuando carga
	onload = function()
	{
		showFilter();
		document.form1.aca_fecha_registro_ini.onkeypress = keypressDate;
	document.form1.aca_fecha_registro_fin.onkeypress = keypressDate;

		search();
	}



	//mostrar filtro de busqueda
	function showFilter()
	{
		document.getElementById("response").style.display='none';
		setFocusOnForm("form1");
	}

	//ejecutar consulta
	function search()
	{
		var url = "${def:actionroot}/search";

		//determina si refresca y se para en la pagina actual o en la pagina 1
		if (currentPage > 0)
			url = "${def:actionroot}/search?currentpage=" + currentPage;

		//definir funcion goBack()
		_goBackFn = showFilter;

		clearErrorMessages();

		//llamada Ajax...
		return ajaxCall(	httpMethod="POST",
							uri=url,
							divResponse="response",
							divProgress="status",
							formName="form1",
							afterResponseFn=null,
							onErrorFn=showFilter);

	}

	//mostrar una pagina del grid
	function viewPage()
	{
		var url = "${def:actionroot}/view";
		//llama a la funcion para ir a la pagina indicada
		gotoPage(url);
	}

	//retorna al estado previo que corresponde
	//al estado actual de la pagina, cada llamada Ajax
	//se encarga de definir cual es la funcion de goBack() que aplica
	function goBack()
	{
		_goBackFn()
	}

	//invoca la generacion de un PDF en un popup
	function openPDF()
	{
		var features = "height=500,width=800,status=no,toolbar=no,menubar=no,location=no,scrollbars=yes,resizable=yes";
		var url = "${def:context}${def:actionroot}/pdf?random=" + Math.random();
		var w = window.open(url, null, features);
	}

	//invoca la generacion de un Excel en un popup
	function openExcel()
	{
		var features = "height=500,width=800,status=no,toolbar=no,menubar=no,location=no,scrollbars=yes,resizable=yes";
		var url = "${def:context}${def:actionroot}/excel?random=" + Math.random();
		var w = window.open(url, null, features);
	}

	//exportar a xml
	function openXml() {
		var features = "height=500,width=800,status=no,toolbar=no,menubar=no,location=no,scrollbars=yes,resizable=yes";
		var url = "${def:context}${def:actionroot}/xml/search?random=" + Math.random();
		var w = window.open(url, null, features);
	}

	//exportar a texto
	function openTxt() {
		var features = "height=500,width=800,status=no,toolbar=no,menubar=no,location=no,scrollbars=yes,resizable=yes";
		var url = "${def:context}${def:actionroot}/txt/search?random=" + Math.random();
		var w = window.open(url, null, features);
	}

	//envio de emails
	function openEmails() {
		var uri = "${def:context}${def:actionroot}/email/form";
		openDialog("editor0", uri, 950, 600);
	}

	function setSelectedIndex(combo, value) {
	    for (var i = 0; i < combo.options.length; i++) {
	        if (combo.options[i].value == value) {
	        	combo.options[i].selected = true;
	        	//alert('Selected = '+combo.options[i].selected);
	            return;
	        }
	    }
	}

	//mostrar el detalle de un registro
	/*function getDetail(id)
	{
//		//alert('Colocar su c�digo aqu�.')

		var uri = "${def:context}${def:actionroot}/detail/form?id=" + id;
		openDialog("dialog", uri, 650, 600);
	}*/

	//mostrar el detalle de un registro
	function getDetail(id,auxiliary)
	{
//		//alert('Colocar su c�digo aqu�.')
		//alert('Auxiliary Class Main 4 --> ' + auxiliary);
		var uri = getAuxiliary(auxiliary,'detail') + "?id=" + id;
		//var uri = "${def:context}${def:actionroot}/detail/form?id=" + id;
		openDialog("dialog", uri, 950, 600);
	}

	//muestra un DIV+IFRAME con el formulario de CRUD
	/*function showEditor(id)
	{
//		//alert('Colocar su c�digo aqu�.')

		//editor a nivel de panel iconogr�fico
		if (id == 'editor')
		{
			var uri = "${def:context}${def:actionroot}/editor/form";
			openDialog("editor1", uri, 650, 600);
		}
		else if (id == 'filter')
		{
			var uri = "${def:context}${def:actionroot}/filter/form";
			openDialog("editor2", uri, 950, 600);
		}
		else if (id == 'importexcel')
		{
			var uri = "${def:context}${def:actionroot}/importexcel/form";
			openDialog("editor3", uri, 950, 600);
		}
		else if (id == 'repgen')
		{
			var uri = "${def:context}${def:actionroot}/repgen/form";
			openDialog("editor4", uri, 950, 600);
		}
		//editor a nivel de registros
		else {
			var uri = "";
			if (id==null)
				uri = "${def:context}${def:actionroot}/editor/form";
			else
				uri = "${def:context}${def:actionroot}/editor/form?id=" + id;

			openDialog("editor5", uri, 650, 600);
		}

	}*/

	//muestra un DIV+IFRAME con el formulario de CRUD
	function showEditor(id,auxiliary)
	{
//		//alert('Colocar su c�digo aqu�.')

		//editor a nivel de panel iconogr�fico
		if (id == 'editor')
		{
			var uri = "${def:context}${def:actionroot}/editor/form";
			openDialog("editor1", uri, 950, 520);
		}
		else if (id == 'filter')
		{
			var uri = "${def:context}${def:actionroot}/filter/form";
			openDialog("editor2", uri, 950, 600);
		}
		else if (id == 'importexcel')
		{
			var uri = "${def:context}${def:actionroot}/importexcel/form";
			openDialog("editor3", uri, 950, 600);
		}
		else if (id == 'repgen')
		{
			var uri = "${def:context}${def:actionroot}/repgen/form";
			openDialog("editor4", uri, 950, 600);
		}
		//editor a nivel de registros
		else
		{
			var uri = "";
			if (id==null)
			{
				uri = getAuxiliary(auxiliary,'editor',false);
				//uri = "${def:context}${def:actionroot}/editor/form";
			}
			else
			{
				uri = getAuxiliary(auxiliary,'editor',true) + "?id=" + id;
				//uri = "${def:context}${def:actionroot}/editor/form?id=" + id;
			}
			//alert(uri);
			openDialog("editor5", uri, 950, 600);
		}

	}

	function getAuxiliary(auxiliary,view,isView)
	{
		var auxClass = auxiliary.toLowerCase();
		//alert('Auxiliary Class Main 3 --> ' + auxClass);

		var uri;
		if (auxClass.indexOf('banco') != -1)
		{
			//alert('Banco --> '+auxClass);
			if (isView)
			{
				uri = '${def:context}${def:actionroot}/' + view + '/banco/editor/form';
			}
			else
			{
				uri = '${def:context}${def:actionroot}/' + view + '/banco/form';
			}
		}
		else if (auxClass.indexOf('contable') != -1)
		{
			//alert('Contable --> '+auxClass);
			if (isView)
			{
				uri = '${def:context}${def:actionroot}/' + view + '/contable/editor/form';
			}
			else
			{
				uri = '${def:context}${def:actionroot}/' + view + '/contable/form';
			}
		}
		else if (auxClass.indexOf('medico') != -1)
		{
			//alert('Medico --> '+auxClass);
			if (isView)
			{
				uri = '${def:context}${def:actionroot}/' + view + '/medico/editor/form';
			}
			else
			{
				uri = '${def:context}${def:actionroot}/' + view + '/medico/form';
			}
		}
		else if (auxClass.indexOf('natural') != -1)
		{
			//alert('Persona Natural --> '+auxClass);
			if (isView)
			{
				uri = '${def:context}${def:actionroot}/' + view + '/natural/editor/form';
			}
			else
			{
				uri = '${def:context}${def:actionroot}/' + view + '/natural/form';
			}
		}
		else if (auxClass.indexOf('servicio') != -1)
		{
			//alert('Proveedor Servicio --> '+auxClass);
			if (isView)
			{
				uri = '${def:context}${def:actionroot}/' + view + '/servicio/editor/form';
			}
			else
			{
				uri = '${def:context}${def:actionroot}/' + view + '/servicio/form';
			}
		}
		else if (auxClass.indexOf('tercero') != -1)
		{
			//alert('Proveedor Servicio --> '+auxClass);
			if (isView)
			{
				uri = '${def:context}${def:actionroot}/' + view + '/tercero/editor/form';
			}
			else
			{
				uri = '${def:context}${def:actionroot}/' + view + '/tercero/form';
			}
		}
		//alert(uri);
		return uri;
	}

	function openDialogBox(auxiliary)
	{
		var auxClass = auxiliary.toLowerCase();
		//alert('Auxiliary Class Main 2 --> ' + auxClass);

		if (auxClass.indexOf('banco') != -1)
		{
			//alert('Banco --> '+auxClass);
			var uri = '${def:context}${def:actionroot}/editor/banco/form';
			openDialog("editor100", uri, 950, 600);
		}
		else if (auxClass.indexOf('contable') != -1)
		{
			//alert('Contable --> '+auxClass);
			var uri = '${def:context}${def:actionroot}/editor/contable/form';
			openDialog("editor200", uri, 950, 600);
		}
		else if (auxClass.indexOf('medico') != -1)
		{
			//alert('Medico --> '+auxClass);
			var uri = '${def:context}${def:actionroot}/editor/medico/form';
			openDialog("editor300", uri, 950, 600);
		}
		else if (auxClass.indexOf('natural') != -1)
		{
			//alert('Persona Natural --> '+auxClass);
			var uri = '${def:context}${def:actionroot}/editor/natural/form';
			openDialog("editor400", uri, 950, 600);
		}
		else if (auxClass.indexOf('servicio') != -1)
		{
			//alert('Proveedor Servicio --> '+auxClass);
			var uri = '${def:context}${def:actionroot}/editor/servicio/form';
			openDialog("editor500", uri, 950, 600);
		}
		else if (auxClass.indexOf('tercero') != -1)
		{
			//alert('Tercero --> '+auxClass);
			var uri = '${def:context}${def:actionroot}/editor/tercero/form';
			openDialog("editor600", uri, 950, 600);
		}

	}

	function deleteRecord(id) {
//		//alert('Colocar su c�digo aqu�.')

		alertBox('${lbl:b_delete_record_button}', '${lbl:b_delete_button}', '${lbl:b_cancel_button}', 'deleteRecordOK(' + id + ')')
	}

	//eliminar un registro
	function deleteRecordOK(id) {
			ajaxCall(httpMethod="GET",
							uri="${def:actionroot}/delete?id=" + id,
							divResponse=null,
							divProgress="status",
							formName=null,
							afterResponseFn=null,
							onErrorFn=null);
	}


</script>

</html>
